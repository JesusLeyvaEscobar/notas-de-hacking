# Objetivo

Los oráculos pueden ser tu mejor amigo, descifrarán cualquier cosa, excepto el texto cifrado de la bandera. ¿Cómo lo romperás? Conéctese con `nc mercury.picoctf.net 30048`.
1. ¿Qué se puede hacer con un par diferente de texto cifrado y texto sin formato? ¿Y si después de todo no es tan diferente...?
## Solución

Después de enlazarnos, obtenemos lo siguiente:
```
┌──(jesus㉿KaliJesus)-[~/Desktop/github/notas-de-hacking/3erParcial-RetosCrypto]
└─$ nc mercury.picoctf.net 30048        
Welcome to the Padding Oracle Challenge
This oracle will take anything you give it and decrypt using RSA. It will not accept the ciphertext with the secret message... Good Luck!

n: 75595438124015001245477622643642059345501880590272445929471223796029180292239332840646007251212087309580173476043174681052903376208362187257074620822677584059287770343345876049391397663646219631178406367956477799458339106436614555513851374486222535628604436830220326817782165761946977725483414610709813188359
e: 65537
ciphertext: 24811699911001708634774813910082687758555112187164284393308868360285392773391820053257444104762050439971867996579149202672004140546079176358344130178938374682049768393685888720222699110516579103533331759640519646919245479643593405137481066610525600331581715396797993806575558162459355934764723772017935741596

Give me ciphertext to decrypt: 29647377799886544976086147676415382024132851484150256416060561893354790747824617694386860141042900768937284814423699443987724175692189034411452510911546339075951006206527254134936853635410204157254198937349936943604950766874402137501109220743314135118423497596406470555414150729465131050273500002307184007362

Will not decrypt the ciphertext. Try Again

Give me ciphertext to decrypt:  
 
```
Si tratamos de desencriptar el `ciphertext`, no nos lo va a permitir.

El reto, nos dice que en esta ocasión no tenemos `padding` por lo que necesitaremos entender que es el cifrado homomorfico. 

Recordando un poco de teoría RSA:
```
c - Texto cifrado
m - mensaje texto plano
p - primo 1
q - primo 2
n - modulo
tn - totient n (euler)
e - exponente (llave publica) 2^16~+1=65537
d - llave privada

n = p * q
tn = (p-1)*(q-1)
d = e mod inv tn / inverse(e,tn)

Encriptar	: c = m ^ e mod n / pow(m,e,n)
Desencriptar	: m = c ^ d mod n / pow(c,d,n)

Homomorfico:

encriptar(m1) * encriptar(m2) = encriptar(m1 * m2)
```
En el caso de un cifrado sin `padding`, este se vuelve un cifrado homomorfico, lo que significa que sigue las reglas establecidas en nuestra teoria RSA.

Nos ayudaremos de `python` para poder realizar las operaciones correspondientes para obtener el texto plano resultante.
```
┌──(jesus㉿KaliJesus)-[~]
└─$ python3
Python 3.11.6 (main, Oct  8 2023, 05:06:43) [GCC 13.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> n=152399715596408728591754802938874749063277762721500063571160349075396564178477685896145919975660254912119330603607404981305658056817048884488964082663873861301978087345467961834927849194917916334238880354424459849663604775687126334027574868735199423443151516442386967374690866850814061726606857991976658788761
>>> e=65537
>>> c=146040445552800756012543439772291224897332507056122378999018051594914880582035041352962282288866100118004948993111440740698800803622258968008810658522884582366920567762519150515923773948234198928544351708401181465298383565818246377665016146159812351696724945925335997354992739774295496785751242142764645735663
>>> m=pow(6,e,n)
>>> m
1580992921869654226389791273047410663238790655091878243586921372658672712914259707682750528414804210562722684424329335752792113731293921495953898630413748153211640143288024898040695573587823414733643416479342061147328016458069021141074942959065373245544829611672753671598646849953640828482717074082169512692
>>> m*c
230888910725668617678120740275722859704489677243152878513796871981811574142790706480825459037063611987297843792611517230491515640251101309081378663012279042346273587804073748124965152096824331296087154050837827331894767345089126106721161662984619795290459898051989084317812549966503866159215172235177172810264945722306068574348182449191684813784286225419735214342090475234692243907207039940384326233959509740984417084848210935914821955302858359277185909567413369312040087370220741773864839808085255432259037179535351081787164297076746029188215863173699508649947056928892326429584381887404405134485643807444555534796
>>> 
```
Ahora, este resultado de una multiplicación, lo vamos a encriptar con la herramienta a la que hicimos conexión inicialmente:
```
Give me ciphertext to decrypt: 230888910725668617678120740275722859704489677243152878513796871981811574142790706480825459037063611987297843792611517230491515640251101309081378663012279042346273587804073748124965152096824331296087154050837827331894767345089126106721161662984619795290459898051989084317812549966503866159215172235177172810264945722306068574348182449191684813784286225419735214342090475234692243907207039940384326233959509740984417084848210935914821955302858359277185909567413369312040087370220741773864839808085255432259037179535351081787164297076746029188215863173699508649947056928892326429584381887404405134485643807444555534796
Here you go: 1741650181175100236840739710204735310419794493107668460540462322680219887104408155603936614224815508672308277386139539415790
Give me ciphertext to decrypt:
```
Después de encriptar el texto, lo vamos a pasar a nuestro código como `long_to_bytes` y obtenemos nuestra bandera:
```
>>> from Crypto.Util.number import long_to_bytes
long_to_bytes((1741650181175100236840739710204735310419794493107668460540462322680219887104408155603936614224815508672308277386139539415790)//6)
b'picoCTF{m4yb3_Th0se_m3s54g3s_4r3_difurrent_5052620}'
```
## Notas adicionales

- `Cifrado homomórfico`-> Es un sistema capaz de realizar una operación algebraica concreta sobre un texto original, equivalente a otra operación algebraica sobre el resultado cifrado de este texto original.
## Referencias

- padding oracle attack : [https://en.wikipedia.org/wiki/Padding...](https://www.youtube.com/redirect?event=video_description&redir_token=QUFFLUhqa0hsZkV1WFV2UG9aczRBRjB6NTRLdXhYbnAyZ3xBQ3Jtc0tuekYxRGRvNTQxWE1qd3RMUHBGQk4zdjdOMFByRUVva1JadWpscVRLRFFfc3pWZTktbVVaM1kwMkxhQ2NDTDJzd0hXUUZpdmtUWndBblhTUFBZSWhxR3hNeUYzWVZWNDdrUGpFRDF3T2tKSEVTcU0wYw&q=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FPadding_oracle_attack&v=UN9M9Cby1zc) 
- homomorphic encryption : [https://en.wikipedia.org/wiki/Homomor..](https://www.youtube.com/redirect?event=video_description&redir_token=QUFFLUhqa3RVX19lWDNJclh5bDZFNkticU9mNGRmUGVvZ3xBQ3Jtc0tudjNwVGFncVB3YkxOTWs0VmhaTmZpSjEtWWdGUEN1a0xwaG9kV0xrYUVmdy1YOF9Jc2F1a2JUUFJEN0FRbTlPVTMyaS16eUJoN290RUpJS1pzZ1puS2JLLXhxQkRsYjdyTG1RSnd2VERkWmNqTXVNVQ&q=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FHomomorphic_encryption&v=UN9M9Cby1zc)